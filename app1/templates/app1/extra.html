Ansar Ahmed
ULTIMATE DESIGN TECHNOLOGY LLP
EE
1173919287
1173919287
Mumbai
ansar@mail.com



make parameter dynamic

and check pagination code sort all data this code sort current page data only
when i go to next page then it not return next sorted data it return constant data that belong to that page


*********************
i generate token using console.cloud.google.com so i want login api using drf
I am creating a flutter android app which uses google sign in. Once logged in, I recieve accesstoken 
 I want to use this token to authenticate my backend which uses django social auth
i want logn api using this labrary pip install google-auth to using tokon that generated by google
so this is my model "class UserEnrolled(models.Model):
    sr = models.AutoField(primary_key=True, unique=True)
    picture = models.ImageField(upload_to='user_pictures/', blank=True, null=True)
    name = models.CharField(max_length=255)
    company_name = models.CharField(max_length=100)
    job_role = models.CharField(max_length=100)
    mycompany_id = models.CharField(max_length=10)
    tag_id = models.CharField(max_length=50)
    job_location = models.CharField(max_length=100)
    orientation = models.FileField(upload_to='attachments/', blank=True, null=True, validators=[FileExtensionValidator(['jpeg', 'jpg'])])
    facial_data = models.ImageField(upload_to=user_image_upload_path, blank=True, null=True, verbose_name='Facial Data')
    my_comply = models.ImageField(upload_to='compliance_images/', blank=True, null=True)
    expiry_date = models.DateField(blank=True, null=True)
    status = models.CharField(max_length=100, choices=[
        ('active', 'Active'),
        ('inactive', 'Inactive'),
        ('pending', 'Pending'),
    ], default='pending')
    email = models.EmailField()
    password = models.CharField(max_length=50)
    site = models.ForeignKey('Site', on_delete=models.CASCADE, blank=True, null=True)

    def _str_(self):
        return self.name

    def get_folder_name(self):
        return self.name

    def set_password(self, raw_password):
        self.password = make_password(raw_password)

    def check_password(self, raw_password):
        return check_password(raw_password, self.password)" 

 i created this api for login so modify this api 
"class LoginAPIApp(APIView):
def post(self, request, format=None):
    serializer = LoginSerializerApp(data=request.data)
    if serializer.is_valid():
        email = serializer.validated_data['email']
        user = UserEnrolled.objects.get(email=email)
        name = user.name
        return Response({'message': 'Login successful', 'name': name}, status=status.HTTP_200_OK)
    return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)"

this is serializer "class LoginSerializerApp(serializers.Serializer):
email = serializers.EmailField()
password = serializers.CharField()

def validate(self, data):
    email = data.get('email')
    password = data.get('password')

    if not email or not password:
        raise serializers.ValidationError("Both email and password are required.")

    user = UserEnrolled.objects.filter(email=email, password=password).first()
    if not user:
        raise serializers.ValidationError("Invalid email or password.")

    return data
"

and i use this code "AUTHORIZATION_BASE_URL = 'https://accounts.google.com/o/oauth2/v2/auth'
TOKEN_URL = 'https://www.googleapis.com/oauth2/v4/token'

# Your Google OAuth credentials
CLIENT_ID = '52626193424-a1jbs1qjon46em8s1jjsh4or6ssk5cn2.apps.googleusercontent.com'
CLIENT_SECRET = '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'
REDIRECT_URI = 'http://localhost:8000/oauth2callback'

# Scopes you need for the API access
SCOPES = ['https://www.googleapis.com/auth/userinfo.email', 'https://www.googleapis.com/auth/userinfo.profile']

@ensure_csrf_cookie
def google_login(request):
    google = OAuth2Session(CLIENT_ID, redirect_uri=REDIRECT_URI, scope=SCOPES)
    authorization_url, state = google.authorization_url(AUTHORIZATION_BASE_URL, access_type="offline", prompt="select_account")

    return HttpResponseRedirect(authorization_url)

@csrf_protect
def google_callback(request):
    code = request.GET.get('code')
    google = OAuth2Session(CLIENT_ID, redirect_uri=REDIRECT_URI, state=request.GET.get('state'))
    token = google.fetch_token(TOKEN_URL, code=code, client_secret=CLIENT_SECRET)

    # Fetch user data from Google API
    resp = google.get('https://www.googleapis.com/oauth2/v1/userinfo')
    userinfo = resp.json()

    # Now you can authenticate the user in your system
    # This is just an example, you should implement your own logic
    user = authenticate(email=userinfo['email'], password=userinfo['email'])
    if user:
        login(request, user)
        return HttpResponseRedirect('/your-protected-page')
    else:
        return HttpResponse('Authentication failed')"

make all this correct 


************************************

modify this api i want picture,name,location

"class SubAdminSitesAPIView(generics.GenericAPIView):
def get(self, request, *args, **kwargs):
    email = request.query_params.get('email')
    if not email:
        return Response({'error': 'Email parameter is required.'}, status=status.HTTP_400_BAD_REQUEST)
    
    try:
        user = CustomUser.objects.get(email=email)
        if not user.is_staff:
            return Response({'error': 'User is not a sub-admin.'}, status=status.HTTP_403_FORBIDDEN)
        
        sites = user.sites.all()
        serializer = SubAdminSiteSerializer(sites, many=True)
        return Response(serializer.data, status=status.HTTP_200_OK)
    except CustomUser.DoesNotExist:
        return Response({'error': 'User not found.'}, status=status.HTTP_404_NOT_FOUND)"

this is serializer "class SubAdminSiteSerializer(serializers.ModelSerializer):
class Meta:
    model = Site
    fields = ['name']  # Adjust fields as needed"

"@login_required
def create_subadmin(request):
    site_name = request.GET.get('site_name') or request.session.get('site_name')
    if site_name:
        request.session['site_name'] = site_name
        
    success_message = None  # Initialize success message variable

    if request.method == 'POST':
        form = SubAdminCreationForm(request.POST)
        if form.is_valid():
            user = form.save(commit=False)
            user.is_staff = True
            user.is_superuser = False
            user.set_password(form.cleaned_data['password'])
            user.save()
            sites = form.cleaned_data['sites']
            user.sites.set(sites)
            success_message = "Subadmin created successfully!"  # Set success message
            form = SubAdminCreationForm()  # Reset form after successful submission
        else:
            # Return form errors with the form
            
            return render(request, 'app1/create_subadmin.html', {'form': form, 'errors': form.errors})

    else:
        form = SubAdminCreationForm()
    sites = Site.objects.all()
    site_names = [(site.name, site.name) for site in sites]
    return render(request, 'app1/create_subadmin.html', {
        'form': form,
        'success_message': success_message,  # Pass success message to template
        'site_name':site_name,
        'site_names':site_names,
    })"

this is form "class SubAdminCreationForm(forms.ModelForm):
password = forms.CharField(widget=forms.PasswordInput, required=True)
sites = forms.ModelMultipleChoiceField(
    queryset=Site.objects.all(),
    widget=forms.CheckboxSelectMultiple,
    required=False,
)

class Meta:
    model = CustomUser
    fields = ['email', 'name', 'company_name', 'job_role', 'mycompany_id', 'tag_id', 'job_location', 'password', 'sites']"

this is model "class CustomUser(AbstractBaseUser, PermissionsMixin):
email = models.EmailField(unique=True)
name = models.CharField(max_length=255)  # Add this field
company_name = models.CharField(max_length=100)  # Add this field
job_role = models.CharField(max_length=100)  # Add this field
mycompany_id = models.CharField(max_length=10)  # Add this field
tag_id = models.CharField(max_length=50)  # Add this field
job_location = models.CharField(max_length=100)  # Add this field
is_active = models.BooleanField(default=True)
is_staff = models.BooleanField(default=False)
date_joined = models.DateTimeField(default=timezone.now)
sites = models.ManyToManyField('Site', blank=True)

objects = CustomUserManager()

USERNAME_FIELD = 'email'
REQUIRED_FIELDS = ['name', 'company_name', 'job_role', 'mycompany_id', 'tag_id', 'job_location']

def __str__(self):
    return self.email"

this is site model "class Site(models.Model):
picture = models.ImageField(upload_to='site_pictures/', blank=True, null=True)
name = models.CharField(max_length=100,unique=True)
location = models.CharField(max_length=100)

def save(self, *args, **kwargs):
    self.name = self.name.upper()
    super(Site, self).save(*args, **kwargs)
    
def __str__(self):
    return self.name"


i want complete url of picture like this "http://127.0.0.1:8000//media/site_pictures/site_image1_1TWWy0V.jpg"